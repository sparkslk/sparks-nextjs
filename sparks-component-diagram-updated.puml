@startuml SPARKS-ADHD-Therapy-Management-Platform-Updated
!theme aws-orange
title SPARKS - ADHD Therapy Management Platform\nUpdated Component Diagram (Accurate Implementation)

!define RECTANGLE class

package "Client Applications" {
    RECTANGLE WebClient [
        **Web Application**
        --
        • Next.js 15.3.3 Frontend
        • React 19 Components
        • TypeScript
        • Tailwind CSS + Radix UI
        • Framer Motion
        • PWA Ready
    ]
    
    RECTANGLE MobileClient [
        **Mobile Application**
        --
        • Responsive Web Design
        • Mobile Optimized UI
        • Touch-friendly Components
        • Offline Capabilities (Future)
    ]
    
    note right of WebClient
        **User Roles:**
        • Normal Users (Patients)
        • Parent/Guardians
        • Therapists
        • Managers
        • Admins
    end note
}

package "Server Infrastructure" {
    RECTANGLE NextJsServer [
        **Next.js Server**
        --
        • App Router (v13+)
        • Server-Side Rendering
        • API Routes
        • Middleware for Auth
        • Static Generation
        • Edge Runtime Support
    ]
    
    RECTANGLE ApiLayer [
        **REST API Layer**
        --
        • /api/auth/* - Authentication
        • /api/profile/* - User Management
        • /api/therapist/* - Therapist APIs
        • /api/parent/* - Parent APIs
        • /api/sessions/* - Session Management
        • /api/admin/* - Admin Functions
        • /api/notifications/* - Notifications
        • /api/swagger - API Documentation
    ]
}

package "Authentication & Authorization" {
    RECTANGLE NextAuth [
        **NextAuth.js v4.24.11**
        --
        • Google OAuth Provider
        • Credentials Provider
        • JWT Strategy
        • Session Management
        • Role-based Access Control
        • Prisma Adapter
    ]
    
    RECTANGLE AuthMiddleware [
        **Auth Middleware**
        --
        • Route Protection
        • Role Validation
        • Session Verification
        • Redirect Logic
    ]
}

package "Database Layer" {
    RECTANGLE PrismaORM [
        **Prisma ORM v6.9.0**
        --
        • Type-safe Database Access
        • Schema Management
        • Migration System
        • Query Builder
        • Connection Pooling
    ]
    
    RECTANGLE PostgreSQL [
        **PostgreSQL Database**
        --
        **Core Tables:**
        • Users & Accounts
        • Patients & Therapists
        • TherapySessions
        • TreatmentPlans
        • Notifications
        • ParentGuardian Relations
        • Organizations
        • Assessments & Tasks
    ]
}

package "External Services & Integrations" {
    RECTANGLE EmailService [
        **Email Service**
        --
        • SMTP Integration
        • Notification Emails
        • Appointment Reminders
        • (Implementation Pending)
    ]
    
    RECTANGLE PaymentGateway [
        **Payment Gateway**
        --
        • Hela Pay (Sri Lankan)
        • Session Payments
        • Commission Management
        • (Future Implementation)
    ]
    
    RECTANGLE GoogleCloud [
        **Google Cloud Services**
        --
        • OAuth Authentication
        • Cloud Storage (Future)
        • Analytics (Future)
    ]
}

package "Development & Deployment" {
    RECTANGLE Docker [
        **Docker Containerization**
        --
        • Dockerfile
        • docker-compose.yaml
        • Production Ready
        • Port 3003 Mapping
    ]
    
    RECTANGLE VersionControl [
        **Git Repository**
        --
        • Source Code Management
        • Branching Strategy
        • CI/CD Integration
        • GitHub Actions (Future)
    ]
    
    RECTANGLE ApiDocumentation [
        **API Documentation**
        --
        • Swagger/OpenAPI 3.0
        • Interactive Documentation
        • Endpoint Testing
        • Schema Validation
    ]
}

package "Notification System" {
    RECTANGLE NotificationManager [
        **Database Notifications**
        --
        • Appointment Notifications
        • Session Updates
        • System Alerts
        • Emergency Notifications
        • Real-time Updates (SSE)
    ]
}

' Connections
WebClient --> NextJsServer : HTTPS
MobileClient --> NextJsServer : HTTPS
NextJsServer --> ApiLayer : Internal
ApiLayer --> NextAuth : Authentication
ApiLayer --> PrismaORM : Database Queries
NextAuth --> AuthMiddleware : Session Validation
AuthMiddleware --> ApiLayer : Protected Routes
PrismaORM --> PostgreSQL : SQL Queries
ApiLayer --> NotificationManager : Create/Fetch
NotificationManager --> PostgreSQL : Store Notifications
NextJsServer --> EmailService : Send Emails
ApiLayer --> PaymentGateway : Process Payments
NextAuth --> GoogleCloud : OAuth Flow
NextJsServer --> Docker : Containerized Deployment
ApiDocumentation --> ApiLayer : Document APIs

' Data Flow Annotations
note right of ApiLayer
    **Key API Endpoints:**
    • Authentication & User Management
    • Session Request/Approval Flow
    • Patient-Therapist Matching
    • Parent-Child Management
    • Real-time Notifications
    • Progress Tracking
end note

note right of PostgreSQL
    **Database Features:**
    • Role-based Data Access
    • Session Status Management
    • Treatment Plan Tracking
    • Assessment Storage
    • Audit Trail Logging
end note

note bottom of Docker
    **Deployment Stack:**
    • Next.js Production Build
    • PostgreSQL Database
    • Environment Configuration
    • Scalable Architecture
end note

@enduml
